<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Docs</title>
<link id="dynamicFavicon" href="https://ssl.gstatic.com/docs/doclist/images/mediatype/icon_1_document_x16.png" rel="icon" type="image/x-icon">
<style>
/* --- Core Layout --- */
body { margin:0; font-family:"Segoe UI",sans-serif; background:#0d0d1a; color:white; height:100vh; overflow:hidden; }
.full-btn {display: none;} 

/* --- Sidebar --- */
.sidebar { width:320px; background:#14142b; padding:20px; display:flex; flex-direction:column; overflow-y:auto; border-right:2px solid #252550; position:absolute; top:0; left:0; bottom:0; transition: transform 0.3s ease; z-index:2; }
.sidebar.hidden { transform:translateX(-100%); }
.sidebar h1 { font-size:22px; margin-bottom:10px; text-shadow:0 0 10px #5a5aff; }
.sidebar h1.panic-note { font-size:12px; }

/* --- Inputs & Controls --- */
input { width:100%; padding:10px; border-radius:8px; border:none; margin-bottom:10px; background:#1f1f3d; color:white; position:sticky; top:50px; z-index:5; box-sizing: border-box; }
.az-filter { display:flex; flex-wrap:wrap; gap:4px; margin-bottom:6px; position:sticky; top:110px; background:#14142b; padding-top:5px; z-index:4; }
.az-filter button { background:#262650; border:none; padding:4px 7px; border-radius:4px; cursor:pointer; font-size:12px; color:white; }
.az-filter button:hover { background:#4f4f9e; }

#favBtn { background:#262650; border:none; border-radius:6px; padding:6px 0; margin:6px 0 10px 0; width:100%; cursor:pointer; font-size:14px; }
#favBtn:hover { background:#4f4f9e; }

/* --- NEW: Settings Button --- */
#settingsBtn { background:#3b3b5c; border:none; border-radius:6px; padding:8px 0; margin:0 0 10px 0; width:100%; cursor:pointer; font-size:14px; color: #ddd; display: flex; justify-content: center; align-items: center; gap: 6px; }
#settingsBtn:hover { background:#5a5aff; color: white; }

/* --- Games Grid --- */
#gamesContainer { flex:1; overflow-y:auto; scrollbar-width:none; margin-top:5px; }
#gamesContainer::-webkit-scrollbar { display:none; }
.game-card { background:#1b1b38; border-radius:12px; margin-bottom:15px; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,.3); }
.game-card img { width:100%; height:160px; object-fit:cover; }
.game-info { padding:10px; text-align:center; }
.game-title { font-size:16px; display:flex; justify-content:center; align-items:center; gap:6px; }
.star { cursor:pointer; font-size:18px; color:gold; }
.star.off { color:gray; }
.button-row { display:flex; gap:8px; justify-content:center; }
.button-row button { background:#5a5aff; border:none; padding:7px 11px; border-radius:6px; color:white; cursor:pointer; font-size:14px; }
.button-row button:hover { background:#7878ff; }

/* --- Toggle Button --- */
.toggle-sidebar { position:absolute; top:50%; transform:translateY(-50%); background:#5a5aff; padding:8px; border-radius:0 8px 8px 0; cursor:pointer; font-size:18px; z-index:3; left:362px; transition:left 0.3s; }
.toggle-sidebar:hover { background:#7474ff; }

/* --- Content Area --- */
.content { position:absolute; top:0; bottom:0; left:320px; right:0; transition:left 0.3s; }
.content.full { left:0; }
.content iframe { width:100%; height:100%; border:none; display: block; }

/* --- Focus Overlay Styles --- */
#focusOverlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 1; /* Behind sidebar */
    cursor: pointer;
    opacity: 0;
    pointer-events: none; 
    transition: opacity 0.2s;
    backdrop-filter: blur(2px);
}
#focusOverlay.active {
    opacity: 1;
    pointer-events: auto;
}
#focusOverlay h2 { margin: 0 0 10px 0; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; }
#focusOverlay p { margin: 0; color: #aaa; }

/* --- NEW: Settings Modal Styles --- */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 100;
  display: flex; justify-content: center; align-items: center;
  opacity: 0; pointer-events: none; transition: opacity 0.2s;
  backdrop-filter: blur(3px);
}
.modal-overlay.open { opacity: 1; pointer-events: auto; }
.modal-box {
  background: #1b1b38; width: 300px; padding: 20px; border-radius: 12px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.5);
  border: 1px solid #252550;
  position: relative;
}
.modal-box h2 { margin-top: 0; font-size: 18px; border-bottom: 1px solid #333; padding-bottom: 10px; }
.close-modal { position: absolute; top: 15px; right: 15px; cursor: pointer; color: #aaa; font-size: 20px; }
.close-modal:hover { color: white; }
.setting-item { margin-top: 15px; }
.setting-item label { display: block; margin-bottom: 5px; font-size: 14px; color: #ccc; }
.setting-item select {
  width: 100%; padding: 8px; border-radius: 6px; border: none;
  background: #262650; color: white; cursor: pointer;
}
.setting-item select:focus { outline: 2px solid #5a5aff; }

</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h1>Game Library</h1>
  <h1 class="panic-note">Press CTRL+Q (both keys) for panic key</h1>
  <input type="text" id="search" placeholder="Search games...">
  <div class="az-filter" id="azFilter"></div>
  
  <button id="settingsBtn">⚙ Settings</button>

  <button id="favBtn">★ Favorites</button>
  <div id="gamesContainer">Loading games...</div>
</div>

<div class="toggle-sidebar" id="toggleBtn">❮</div>

<div class="content" id="content">
    <p id="placeholderText" style="color:#aaa; padding:20px;">Select a game from the sidebar.</p>
    
    <div id="focusOverlay">
        <h2>Paused</h2>
        <p>Click here to resume game</p>
    </div>
</div>

<div class="modal-overlay" id="settingsModal">
  <div class="modal-box">
    <span class="close-modal" id="closeSettings">×</span>
    <h2>Settings</h2>
    
    <div class="setting-item">
      <label for="cloakSelect">Tab Cloak</label>
      <select id="cloakSelect">
        <option value="docs">Google Docs</option>
        <option value="classroom">Google Classroom</option>
        <option value="slides">Google Slides</option>
      </select>
    </div>
  </div>
</div>

<script>
const sidebar = document.getElementById("sidebar");
const toggleBtn = document.getElementById("toggleBtn");
const gamesContainerEl = document.getElementById("gamesContainer");
const contentEl = document.getElementById("content");
const favBtnEl = document.getElementById("favBtn");
const focusOverlay = document.getElementById("focusOverlay");
const placeholderText = document.getElementById("placeholderText");

// Settings Elements
const settingsBtn = document.getElementById("settingsBtn");
const settingsModal = document.getElementById("settingsModal");
const closeSettings = document.getElementById("closeSettings");
const cloakSelect = document.getElementById("cloakSelect");
const dynamicFavicon = document.getElementById("dynamicFavicon");

let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
let showOnlyFav = false;

// ----------------- Tab Cloak Logic -----------------
const cloakData = {
  "docs": {
    title: "Google Docs",
    icon: "https://ssl.gstatic.com/docs/doclist/images/mediatype/icon_1_document_x16.png"
  },
  "classroom": {
    title: "Home",
    icon: "https://ssl.gstatic.com/classroom/favicon.png"
  },
  "slides": {
    title: "Google Slides",
    icon: "https://ssl.gstatic.com/docs/presentations/images/favicon_2023q4.ico"
  }
};

// Load saved cloak or default to Docs
const savedCloak = localStorage.getItem("tabCloak") || "docs";
cloakSelect.value = savedCloak;
applyCloak(savedCloak);

cloakSelect.onchange = (e) => {
  const val = e.target.value;
  applyCloak(val);
  localStorage.setItem("tabCloak", val);
};

function applyCloak(type) {
  const data = cloakData[type];
  if (data) {
    document.title = data.title;
    dynamicFavicon.href = data.icon;
  }
}

// ----------------- Settings Modal -----------------
settingsBtn.onclick = () => {
  settingsModal.classList.add("open");
};
closeSettings.onclick = () => {
  settingsModal.classList.remove("open");
};
// Close if clicked outside the box
settingsModal.onclick = (e) => {
  if (e.target === settingsModal) {
    settingsModal.classList.remove("open");
  }
};


// ----------------- Overlay Logic -----------------
function showFocusOverlay() {
    if(contentEl.querySelector("iframe")) {
        focusOverlay.classList.add("active");
    }
}

function hideFocusOverlay() {
    focusOverlay.classList.remove("active");
    const iframe = contentEl.querySelector("iframe");
    if(iframe) {
        iframe.focus();
        if(iframe.contentWindow) iframe.contentWindow.focus();
    }
}

focusOverlay.onclick = hideFocusOverlay;

// ----------------- Sidebar toggle -----------------
toggleBtn.onclick = () => {
  sidebar.classList.toggle("hidden");
  contentEl.classList.toggle("full");
  toggleBtn.style.left = sidebar.classList.contains("hidden") ? "0" : "362px";
  toggleBtn.textContent = sidebar.classList.contains("hidden") ? "❯" : "❮";
  
  showFocusOverlay();
};

document.getElementById("search").addEventListener("focus", showFocusOverlay);

// ----------------- Utilities -----------------
function formatName(name){
  return name.replace(".html","")
             .replace(/^cl/,"")
             .replace(/[-_]/g," ")
             .replace(/([a-z])([A-Z])/g,"$1 $2")
             .trim()
             .replace(/^./, c => c.toUpperCase());
}

// ----------------- Redirect / Popup guard -----------------
(function(){
  const killList = ["sussyboi01.github.io", "https://sussyboi01.github.io", "http://sussyboi01.github.io"];
  const origOpen = window.open.bind(window);
  window.open = function(url, target, features){
    try {
      if (typeof url === "string" && killList.some(k => url.includes(k))) {
        console.warn("Blocked popup opening to:", url);
        return null;
      }
    } catch (e) { }
    return origOpen(url, target, features);
  };
  setInterval(() => {
    try {
      if (window.top === window.self) {
        const href = location.href || "";
        if (killList.some(k => href.includes(k))) {
          try { window.close(); } catch (e) { }
        }
      }
    } catch (e) { }
  }, 400);
})();

// ----------------- Fetch games -----------------
async function fetchGames(){
  try{
    const res = await fetch("https://api.github.com/repos/sussyboi01/sdgjseiofjsdioejaklsjfkznjvkdrilgqajfpasjfksgperujscklvgbo4hipasjpasl-/git/trees/main?recursive=1");
    const data = await res.json();
    const files = (data && data.tree) ? data.tree.filter(f=>f.path.endsWith(".html")) : [];
    renderGames(files);
    setupAZ(files);
  }catch(err){
    gamesContainerEl.innerHTML="<p style='color:red;'>Failed to load games.</p>";
    console.error(err);
  }
}

// ----------------- Render / Card -----------------
function renderGames(files, letter=null, search=""){
  const img="https://pbs.twimg.com/media/Ggj70WPXcAAV1L9.jpg:small";
  let list = files.filter(f=>{
    const t=formatName(f.path);
    if(letter && !t.toLowerCase().startsWith(letter)) return false;
    if(showOnlyFav && !favorites.includes(f.path)) return false;
    if(search && !t.toLowerCase().includes(search)) return false;
    return true;
  });
  let html = list.map(f=>card(f,img,favorites.includes(f.path))).join("") || "<p style='padding:12px;color:#999;'>No games found.</p>";
  gamesContainerEl.innerHTML=html;
  attach(files);
}

function card(f,img,isFav){
  return `<div class="game-card" data-path="${f.path}">
    <img src="${img}">
    <div class="game-info">
      <div class="game-title">${formatName(f.path)}<span class="star ${isFav?"":"off"}" title="Toggle favorite">★</span></div>
      <div class="button-row">
        <button class="play-btn">Play</button>
        <button class="full-btn"></button>
      </div>
    </div>
  </div>`;
}

function attach(files){
  document.querySelectorAll(".play-btn").forEach(b => {
    b.onclick = e => {
      const p = e.target.closest(".game-card").dataset.path;
      const url = "https://sussyboi01.github.io/sdgjseiofjsdioejaklsjfkznjvkdrilgqajfpasjfksgperujscklvgbo4hipasjpasl-/" + p;

      if(placeholderText) placeholderText.style.display = "none";
      
      const existingIframe = contentEl.querySelector("iframe");
      if(existingIframe) existingIframe.remove();

      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.allow = "fullscreen; autoplay; camera; microphone; display-capture; gamepad; clipboard-write";
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      iframe.style.border = "0";
      iframe.tabIndex = 0;

      contentEl.insertBefore(iframe, focusOverlay);

      hideFocusOverlay(); 
    };
  });
  
  document.querySelectorAll(".star").forEach(s=>{
    s.onclick = e => {
      const p = e.target.closest(".game-card").dataset.path;
      if(favorites.includes(p)){
        favorites = favorites.filter(x=>x!==p);
        e.target.classList.add("off");
      } else {
        favorites.push(p);
        e.target.classList.remove("off");
      }
      localStorage.setItem("favorites", JSON.stringify(favorites));
      const currentSearch = document.getElementById("search").value.toLowerCase();
      renderGames(files, null, currentSearch);
    };
  });
}

// ----------------- A-Z and search -----------------
function setupAZ(files){
  const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
  document.getElementById("azFilter").innerHTML=`<button>All</button>`+letters.map(l=>`<button>${l}</button>`).join("");
  document.querySelectorAll(".az-filter button").forEach(b=>{
    b.onclick = () => {
      const l = b.textContent.toLowerCase();
      renderGames(files, l==="all"?null:l, document.getElementById("search").value.toLowerCase());
    };
  });
  document.getElementById("search").oninput = e => {
    renderGames(files, null, e.target.value.toLowerCase());
  };
  favBtnEl.onclick = () => {
    showOnlyFav = !showOnlyFav;
    favBtnEl.style.background = showOnlyFav ? "#5a5aff" : "#262650";
    renderGames(files, null, document.getElementById("search").value.toLowerCase());
  };
}

// ----------------- Panic key (CTRL+Q) -----------------
document.addEventListener("keydown", e=>{
  if(e.ctrlKey && e.key.toLowerCase()==="q"){
    const url="https://classroom.google.com";
    window.open(url,"_blank");
  }
});

fetchGames();
</script>
</body>
</html>
